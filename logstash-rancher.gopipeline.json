{
    "label_template": "${COUNT}",
    "enable_pipeline_locking": false,
    "name": "Logstash-Rancher",
    "environment_variables": [
        {
            "secure": false,
            "name": "RANCHER_URL",
            "value": "http://esranchermanager001.ad.laterooms.com:8080/"
        },
        {
            "secure": false,
            "name": "RANCHER_ACCESS_KEY",
            "value": "0FEE1CEE9F3BEE33E549"
        },
        {
            "secure": false,
            "name": "PROJECT_NAME",
            "value": "logstash"
        },
        {
            "secure": false,
            "name": "RANCHER_PROJECT_ID",
            "value": "1a5"
        },
        {
            "secure": true,
            "name": "RANCHER_SECRET_KEY",
            "encrypted_value": "r3+nNMMeVOhm8XO4B+fO9LZBnnnAt5fw52NFbb68edpPBn1t2RiqX2h/iflf+V0/"
        }
    ],
    "materials": [
        {
            "type": "dependency",
            "pipeline": "Logstash-Central-Collector",
            "stage": "BuildAndTest",
            "name": "Logstash-Central-Collector",
            "auto_update": true
        },
        {
            "type": "git",
            "url": "git@git.laterooms.com:docker/rancher-logstash.git",
            "destination": "rancher-logstash",
            "name": "rancher-logstash",
            "auto_update": false,
            "branch": "master",
            "shallow_clone": true
        },
        {
            "type": "dependency",
            "pipeline": "Logstash-Metrics",
            "stage": "BuildAndTest",
            "name": "Logstash-Metrics-Collector",
            "auto_update": true
        },
        {
            "type": "dependency",
            "pipeline": "Logstash-AWS-Collector",
            "stage": "BuildAndTest",
            "name": "Logstash-AWS-Collector",
            "auto_update": true
        },
        {
            "type": "dependency",
            "pipeline": "Logstash-Beats",
            "stage": "BuildAndTest",
            "name": "Logstash-Beats-Collector",
            "auto_update": true
        },
        {
            "type": "dependency",
            "pipeline": "Logstash-BigQuery",
            "stage": "BuildAndTest",
            "name": "Logstash-BigQuery",
            "auto_update": true
        }
    ],
    "stages": [
        {
            "name": "rancher-compose",
            "fetch_materials": true,
            "approval": {
                "type": "success",
                "authorization": {
                    "roles": [],
                    "users": []
                }
            },
            "environment_variables": [],
            "jobs": [
                {
                    "name": "rancher-compose",
                    "environment_variables": [],
                    "resources": [
                        "docker"
                    ],
                    "tasks": [
                        {
                            "type": "fetch",
                            "run_if": [
                                "passed"
                            ],
                            "pipeline": "Logstash-Central-Collector",
                            "stage": "BuildAndTest",
                            "job": "BuildAndTest",
                            "is_source_a_file": true,
                            "source": "image_full_tag.txt/image_full_tag.txt",
                            "destination": "logstashcentral"
                        },
                        {
                            "type": "fetch",
                            "run_if": [
                                "passed"
                            ],
                            "pipeline": "Logstash-Metrics",
                            "stage": "BuildAndTest",
                            "job": "BuildAndTest",
                            "is_source_a_file": true,
                            "source": "image_full_tag.txt/image_full_tag.txt",
                            "destination": "logstashmetrics"
                        },
                        {
                            "type": "fetch",
                            "run_if": [
                                "passed"
                            ],
                            "pipeline": "Logstash-AWS-Collector",
                            "stage": "BuildAndTest",
                            "job": "BuildAndTest",
                            "is_source_a_file": true,
                            "source": "image_full_tag.txt/image_full_tag.txt",
                            "destination": "logstashaws"
                        },
                        {
                            "type": "fetch",
                            "run_if": [
                                "passed"
                            ],
                            "pipeline": "Logstash-Beats",
                            "stage": "BuildAndTest",
                            "job": "BuildAndTest",
                            "is_source_a_file": true,
                            "source": "image_full_tag.txt/image_full_tag.txt",
                            "destination": "logstashbeats"
                        },
                        {
                            "type": "fetch",
                            "run_if": [
                                "passed"
                            ],
                            "pipeline": "Logstash-BigQuery",
                            "stage": "BuildAndTest",
                            "job": "BuildAndTest",
                            "is_source_a_file": true,
                            "source": "image_full_tag.txt/image_full_tag.txt",
                            "destination": "logstashbigquery"
                        },
                        {
                            "type": "rake",
                            "run_if": [
                                "passed"
                            ],
                            "working_directory": "rancher-logstash/scripts",
                            "build_file": "upgrade.rb"
                        }
                    ],
                    "tabs": [],
                    "artifacts": [
                        {
                            "source": "rancher-logstash/docker-compose.yml",
                            "destination": "rancher-logstash/docker-compose.yml",
                            "type": "build"
                        }
                    ]
                }
            ]
        },
        {
            "name": "confirm",
            "fetch_materials": true,
            "approval": {
                "type": "manual",
                "authorization": {
                    "roles": [],
                    "users": []
                }
            },
            "environment_variables": [],
            "jobs": [
                {
                    "name": "confirm",
                    "environment_variables": [],
                    "resources": [
                        "docker"
                    ],
                    "tasks": [
                        {
                            "type": "fetch",
                            "run_if": [
                                "passed"
                            ],
                            "pipeline": "Logstash-Rancher",
                            "stage": "rancher-compose",
                            "job": "rancher-compose",
                            "is_source_a_file": true,
                            "source": "rancher-logstash/docker-compose.yml/docker-compose.yml",
                            "destination": "rancher-logstash/"
                        },
                        {
                            "type": "rake",
                            "run_if": [
                                "passed"
                            ],
                            "working_directory": "rancher-logstash/scripts",
                            "build_file": "upgrade.rb",
                            "target": "confirm"
                        }
                    ],
                    "tabs": [],
                    "artifacts": []
                }
            ]
        }
    ]
}